(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{787:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){var n=t.content,u=t.maxHeight;if(!n)return null;var l=s((0,r.useState)(n),2),d=l[0],f=l[1],p=s((0,r.useState)(!1),2),m=p[0],_=p[1],h=s((0,r.useState)(0),2),v=h[0],y=h[1],g=(0,r.createRef)();return(0,r.useEffect)((function(){f((0,o.default)(n)),i.default.registerLanguage("javascript",c.default),e(".markdown-body pre").each((function(e,t){i.default.highlightBlock(t)})),a.default.spacingElementByClassName("markdown-body"),v||y(g&&g.current?g.current.offsetHeight:0)}),[n]),r.default.createElement("div",null,r.default.createElement("div",{ref:g,style:!m&&u&&v>u?{maxHeight:"".concat(u,"px"),overflow:"hidden"}:null,className:"markdown-body _1_Fpd",dangerouslySetInnerHTML:{__html:d}}),function(){return m||!u||v<u?null:r.default.createElement("div",{className:"_2GBbo"},r.default.createElement("span",{className:"btn btn-outline-primary btn-block btn-sm mt-3",onClick:function(e){e.stopPropagation(),_(!m)}},!m&&u&&v>u?"展开全部":"收起"))}())};var r=function(e){if(e&&e.__esModule)return e;var t=l();if(t&&t.has(e))return t.get(e);var n={};if(null!=e){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=r?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}}n.default=e,t&&t.set(e,n);return n}(n(0)),a=u(n(695));n(696);var o=u(n(790)),i=u(n(697)),c=u(n(698));function u(e){return e&&e.__esModule?e:{default:e}}function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}}).call(this,n(68))},790:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;function r(e){e=e||32;for(var t="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",n=t.length,r="",a=0;a<e;a++)r+=t.charAt(Math.floor(Math.random()*n));return r}t.default=function(e){return e?e=function(e){var t=e.match(/\<img(.*?)>/g),n=function(e){var t=/src=[\'\"]?([^\'\"]*)[\'\"]?/i,n=[],r=e.match(/\<img(.*?)>/g);return r&&r.length>0&&r.map((function(e){var r=e.match(t);r&&r[1]&&n.push(r[1])})),n}(e);return n.map((function(e,t){n[t]=e.split("?")[0]})),n="['"+n.join("','")+"']",t&&t.length>0&&t.map((function(t,r){var a=t;a=a.replace(/\?/g,"\\?"),e=e.replace(new RegExp(a,"gm"),'<div onclick="webPictureViewer('+n+","+r+');">'+t+"</div>")})),e}(e=function(e){if(!e)return"";e=e.replace("&nbsp;"," ");var t=/(<a(.*?)>(.*?)<\/a>|<img(.*?)>|<ifram(.*?)>)/gi,n=[],a=e.match(t);a&&a.length>0&&e.match(t).map((function(t){var a="#"+r(18)+"#";n.push({id:a,value:t}),e=e.replace(t,a)}));var o=e.match(/(http:\/\/>http:\/\/|http:\/\/|https:\/\/|www\.|magnet\:\?xt\=)(.*?)(?=\s|http|https|\)|\>|\]|\}|\<|\"|\'|$)/gi);if(o&&o.length>0){o=o.sort((function(e,t){return t.length-e.length}));var i=[];o.map((function(t){var n="#"+r(18)+"#";i.push({id:n,value:t}),e=e.replace(t,n)})),i.map((function(t){var n=-1==t.value.indexOf("http")?"http:"+t.value:t.value;e=e.replace(t.id,"<a href=".concat(n,' target="_blank" rel="nofollow">').concat(t.value,"</a>"))}))}return n.length>0&&n.map((function(t){e=e.replace(t.id,t.value)})),e}(e=function(e){var t=e.match(/(https:\/\/v\.|http:\/\/v\.|v\.)qq\.com\/x\/(page|cover)\/(.*?)(?=\s|http|https|\)|\>|\]|\}|\<|$)/gi);return t&&0!=t.length?(t.map((function(t){var n;try{var r=t.split("?")[0].split(".");r=r[r.length-2].split("/"),n=t.split("?")[0].split("/").pop().split(".")[0]}catch(e){console.log(e)}if(n){var a="//v.qq.com/txp/iframe/player.html?vid=".concat(n);e=e.replace(t,'<iframe frameborder="0" src="'.concat(a,'" allowFullScreen="true"></iframe>'))}})),e):e}(e=function(e){var t=e.match(/(https:\/\/www\.youtube\.com|https:\/\/youtube\.com|http:\/\/www.youtube\.com|http:\/\/youtube\.com|www\.youtube\.com|youtube\.com)\/watch\?v\=(.*?)(?=\s|http|https|\)|\>|\]|\}|\<|$)/gi);return t&&0!=t.length?(t.map((function(t){var n;try{t.split("?")[1].split("&").map((function(e){var t=e.split("=");t&&"v"==t[0]&&(n=t[1])}))}catch(e){console.log(e)}if(n){var r="//www.youtube.com/embed/".concat(n);e=e.replace(t,'<iframe width="100%" style="background:#f9f9f9;" src="'.concat(r,'" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'))}})),e):e}(e=function(e){var t=e.match(/(https:\/\/www\.acfun\.cn|https:\/\/acfun\.cn|http:\/\/www.acfun\.cn|http:\/\/acfun\.cn|www\.acfun\.cn|acfun\.cn)\/v\/(.*?)(?=\s|http|https|\)|\>|\]|\}|\<|$)/gi);return t&&0!=t.length?(t.map((function(t){var n;try{n=(n=t.split("acfun.cn/v/")[1].split("/")[0]).split("?")[0]}catch(e){console.log(e)}if(n){var r="https://www.acfun.cn/player/".concat(n);e=e.replace(t,'<iframe src="'.concat(r,'" id="ACFlashPlayer-re"  scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>'))}})),e):e}(e=function(e){var t=e.match(/(https:\/\/www\.bilibili\.com|https:\/\/bilibili\.com|http:\/\/www.bilibili\.com|http:\/\/bilibili\.com|www\.bilibili\.com|bilibili\.com)\/video\/av(.*?)(?=\s|http|https|\)|\>|\]|\}|\<|$)/gi);return t&&0!=t.length?(t.map((function(t){var n;try{n=(n=t.split("bilibili.com/video/av")[1].split("/")[0]).split("?")[0]}catch(e){console.log(e)}if(n){var r="//player.bilibili.com/player.html?aid=".concat(n);e=e.replace(t,'<iframe src="'.concat(r,'" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>'))}})),e):e}(e=function(e){var t=e.match(/(http:\/\/v\.youku\.com|https:\/\/v\.youku\.com|v\.youku\.com)\/v\_show\/id\_(.*?)(?=\s|http|https|\)|\>|\]|\}|\<|$)/gi);return t&&0!=t.length?(t.map((function(t){var n;try{n=(n=t.split("v.youku.com/v_show/id_")[1].split(".")[0]).split("?")[0]}catch(e){console.log(e)}if(n){var r="//player.youku.com/embed/".concat(n);e=e.replace(t,"<iframe width='100%' src='".concat(r,"' frameborder=0 'allowfullscreen'></iframe>"))}})),e):e}(e=function(e){var t=e.match(/(http:\/\/music\.163\.com|https:\/\/music\.163\.com|music\.163\.com)\/(.*?)(?=\s|http|https|\)|\>|\]|\}|\<|$)/gi);return t&&t.length>0&&t.map((function(t){var n,r=-1;-1!=t.indexOf("/song?")?r=2:-1!=t.indexOf("/playlist?")?r=0:-1!=t.indexOf("/album?")?r=1:-1!=t.indexOf("/dj?")?r=3:-1!=t.indexOf("/radio/?")&&(r=4);try{t.split("?")[1].split("&").map((function(e){var t=e.split("=");"id"==t[0]&&(n=t[1])}))}catch(e){console.log(e)}if(-1!=r&&n)if(2==r){var a="//music.163.com/outchain/player?type=2&id=".concat(n,"&auto=0&height=66");e=e.replace(t,'<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="'.concat(a,'"></iframe>'))}else if(3==r){var o="//music.163.com/outchain/player?type=3&id=".concat(n,"&auto=1&height=66");e=e.replace(t,'<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="'.concat(o,'"></iframe>'))}else if(4==r){var i="//music.163.com/outchain/player?type=4&id=".concat(n,"&auto=1&height=430");e=e.replace(t,'<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=450 src="'.concat(i,'"></iframe>'))}else{var c="//music.163.com/outchain/player?type=".concat(r,"&id=").concat(n,"&height=430");e=e.replace(t,'<iframe type="music" src="'.concat(c,'" height="430"></iframe>'))}})),e}(e=function(e){var t=e.match(/\<pre>(.*?)<\/pre>/g),n=[];t&&t.length>0&&t.map((function(t){var a="#"+r(18)+"#";n.push({id:a,value:t}),e=e.replace(t,a)}));var a=(e=e.replace(/([\r\n])/g,"")).split("<p><br></p>");return a=function(e){for(var t=[],n=0;n<e.length;n++)-1==t.indexOf(e[n])&&t.push(e[n]);return t.length>0&&!t[0]&&t.splice(0,1),t.length>0&&!t[t.length-1]&&t.splice(t.length-1,1),t}(a),e=a.join("<p><br></p>"),n.length>0&&n.map((function(t){e=e.replace(t.id,t.value)})),e}(e))))))))):""}},792:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addComment=function(e){var t=e.posts_id,n=e.parent_id,r=e.reply_id,o=e.contentJSON,i=e.contentHTML,c=e.deviceId,l=e.forward;return function(e,d){var p=d().user.accessToken,m=d().comment,_=d().posts;return new Promise(function(){var h=s(regeneratorRuntime.mark((function s(h){var v,y,g,b,w,k,E,x,O;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,a.default)({type:"mutation",apis:[{api:"addComment",args:{posts_id:t,parent_id:n,reply_id:r,content:o,content_html:i,device:c,forward:l},fields:"\n          success\n          _id\n          "}],headers:{accessToken:p}});case 2:if(g=s.sent,b=u(g,2),v=b[0],y=b[1],h([v,y]),y&&y.success){s.next=9;break}return s.abrupt("return");case 9:return s.next=11,f({id:"cache",args:{_id:y._id},restart:!0})(e,d);case 11:for(x in w=s.sent,k=u(w,2),v=k[0],y=k[1],E=y.data[0],m)x==t?E.parent_id?m[x].data.map((function(e){e._id==E.parent_id&&e.reply.push(E)})):m[x].data.push(E):x==n&&m[x].data.push(E);if(e({type:"SET_COMMENT",state:m}),!n){for(O in _)_[O].data.map((function(e){e._id==t&&(e.comment_count=e.comment_count?e.comment_count+1:1)}));e({type:"SET_POSTS",state:_})}case 19:case"end":return s.stop()}}),s)})));return function(e){return h.apply(this,arguments)}}())}},t.loadMoreReply=function(e){var t=e.postsId,n=e.commentId;return function(e,r){return new Promise(function(){var a=s(regeneratorRuntime.mark((function a(o,i){var c,l,s,d,p,m,_;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return c=r().comment[t],l=0,s=null,c.data.map((function(e,t){e._id==n&&(s=e,l=t)})),a.next=6,f({id:"new-reply",args:{parent_id:s._id,page_size:10,deleted:!1,weaken:!1,start_create_at:s.reply[s.reply.length-1].create_at},restart:!0})(e,r);case 6:if(m=a.sent,_=u(m,2),d=_[0],p=_[1],!d){a.next=13;break}return o(),a.abrupt("return");case 13:p.data.map((function(e){s.reply.push(e)})),c.data[l]=s,e({type:"SET_COMMENT_LIST_BY_ID",name:t,data:c}),o();case 17:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}())}},t.updateComment=function(e){return function(t,n){return new Promise(function(){var r=s(regeneratorRuntime.mark((function r(o){var i,c,l,s;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,a.default)({type:"mutation",apis:[{api:"updateComment",args:JSON.parse(JSON.stringify(e)),fields:"success"}],headers:{accessToken:n().user.accessToken}});case 2:if(i=r.sent,c=u(i,2),l=c[0],c[1],!l){r.next=8;break}return r.abrupt("return",o([l]));case 8:s=e._id,delete e._id,e.content_html&&(e.content_html=decodeURIComponent(e.content_html)),t({type:"UPDATE_COMMENT",id:s,update:d([e])[0]}),o([null]);case 13:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}},t.removeCommnetListById=t.loadCommentList=void 0;var r=n(171),a=c(n(48)),o=c(n(117)),i=c(n(785));function c(e){return e&&e.__esModule?e:{default:e}}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function l(e,t,n,r,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,a)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){l(o,r,a,i,c,"next",e)}function c(e){l(o,r,a,i,c,"throw",e)}i(void 0)}))}}var d=function e(t){return t.map((function(t){if(t.device&&(t._device=i.default.getNameByDeviceId(t.device)),t.create_at&&(t._create_at=(0,r.dateDiff)(t.create_at)),t.update_at&&(t._update_at=(0,r.dateDiff)(t.update_at)),t.images=function(e){for(var t,n=/<img(?:(?:".*?")|(?:'.*?')|(?:[^>]*?))*>/gi,r=/src=[\'\"]?([^\'\"]*)[\'\"]?/i,a=[];t=n.exec(e);){var o=t[0].match(r);o&&o[1]&&(o=o[1]+"?imageView2/2/w/800/auto-orient/format/jpg",a.push(o))}return a}(t.content_html),t.images&&t.images.length>0&&(t._coverImage=t.images[0].split("?")[0]+"?imageView2/2/w/300/auto-orient/format/jpg"),t.content_html){var n=t.content_html;(n=(n=(n=n.replace(/<[^>]+>/g,"")).replace(/\r\n/g,"")).replace(/\n/g," ")).length>137&&(n=n.slice(0,137)+"..."),t.content_summary=n}else t.content_summary="";if(t.posts_id&&t.posts_id.content_html){var a=t.posts_id.content_html;(a=(a=(a=a.replace(/<[^>]+>/g,"")).replace(/\r\n/g,"")).replace(/\n/g,"")).length>120&&(a=a.slice(0,120)+"..."),t.posts_id.content_summary=a}t.reply&&t.reply.map&&(t.reply=e(t.reply))})),t};var f=(0,o.default)({reducerName:"comment",actionType:"SET_COMMENT_LIST_BY_ID",api:"comments",fields:"\n    content_html\n    create_at\n    reply_count\n    like_count\n    device\n    ip\n    blocked\n    deleted\n    verify\n    weaken\n    recommend\n    _id\n    update_at\n    like\n    user_id {\n      _id\n      nickname\n      brief\n      avatar_url\n    }\n    posts_id{\n      _id\n      title\n    }\n    parent_id\n    reply_id {\n      _id\n      user_id{\n        _id\n        nickname\n        brief\n        avatar_url\n      }\n    }\n    reply {\n      _id\n      user_id {\n        _id\n        nickname\n        brief\n        avatar\n        avatar_url\n      }\n      posts_id\n      parent_id\n      reply_id {\n        user_id {\n          _id\n          nickname\n          brief\n          avatar\n          avatar_url\n        }\n      }\n      update_at\n      weaken\n      device\n      like_count\n      create_at\n      content_html\n      like\n    }\n  ",processList:d});t.loadCommentList=f;t.removeCommnetListById=function(e){var t=e.id;return function(e,n){return new Promise(function(){var r=s(regeneratorRuntime.mark((function r(a){var o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:(o=n().comment)[t]&&delete o[t],e({type:"SET_COMMENT",state:o});case 3:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}}},807:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){var n=t.user,u=t.posts,s=t.comment,d=t.children,f=(0,a.default)().history,p=(0,o.useSelector)((function(e){return(0,c.getUserInfo)(e)})),m=(0,o.useStore)(),_=function(e){return(0,i.addBlock)(e)(m.dispatch,m.getState)};if(!p)return null;var h=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var r,a,o,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),r={},!u){e.next=6;break}r.posts_id=u._id,e.next=16;break;case 6:if(!n){e.next=10;break}r.people_id=n._id,e.next=16;break;case 10:if(!s){e.next=14;break}r.comment_id=s._id,e.next=16;break;case 14:return Toastify({text:"缺少资源",duration:3e3,backgroundColor:"linear-gradient(to right, #ff6c6c, #f66262)"}).showToast(),e.abrupt("return");case 16:return e.next=18,_({args:r});case 18:a=e.sent,d=2,o=function(e){if(Array.isArray(e))return e}(l=a)||function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}}(l,d)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}(),i=o[0],(c=o[1])&&c.success?Toastify({text:"屏蔽成功",duration:3e3,backgroundColor:"linear-gradient(to right, #50c64a, #40aa33)"}).showToast():i&&i.message&&Toastify({text:i.message,duration:3e3,backgroundColor:"linear-gradient(to right, #ff6c6c, #f66262)"}).showToast();case 23:case"end":return e.stop()}var l,d}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){l(o,r,a,i,c,"next",e)}function c(e){l(o,r,a,i,c,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}(),v=!1;(u&&u.user_id._id==p._id||s&&s.user_id._id==p._id||n&&n._id==p._id)&&(v=!0);return v&&n?null:r.default.createElement("div",{className:"_1OE8F"},r.default.createElement("span",{className:"a text-secondary _2zJLn","data-toggle":"dropdown",onClick:function(e){e.stopPropagation()}},d||r.default.createElement("svg",null,r.default.createElement("use",{xlinkHref:"/feather-sprite.svg#more-horizontal"}))),r.default.createElement("div",{className:"dropdown-menu dropdown-menu-left"},v&&u||v&&s?r.default.createElement("span",{className:"a dropdown-item",onClick:function(t){t.stopPropagation(),s?e("#editor-comment-modal").modal({show:!0},{type:"edit",comment:s}):f.push("/new-posts?posts_id=".concat(u._id))}},"编辑"):null,!v&&u||!v&&s||!v&&n?r.default.createElement(r.default.Fragment,null,r.default.createElement("span",{className:"a dropdown-item",onClick:h},"不感兴趣"),r.default.createElement("span",{className:"a dropdown-item",onClick:function(t){t.stopPropagation(),e("#report").modal({show:!0},{posts:u,user:n,comment:s})}},"举报")):null))};var r=u(n(0)),a=u(n(277)),o=n(168),i=n(814),c=n(78);function u(e){return e&&e.__esModule?e:{default:e}}function l(e,t,n,r,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,a)}n(737)}).call(this,n(68))},812:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.id,n=e.itemType,s=(0,a.useStore)(),f=(0,a.useSelector)((function(e){return(0,o.getCommentListById)(e,t)}));return r.default.createElement(l.default,d({},e,f,{load:function(e){return(0,i.loadCommentList)(e)(s.dispatch,s.getState)},renderItem:function(t){return"text"==n?r.default.createElement(u.default,{key:t._id,item:t}):r.default.createElement(c.default,{comment:t,key:t._id,postsAuthorId:e.postsAuthorId||""})}}))};var r=s(n(0)),a=n(168),o=n(286),i=n(792),c=s(n(850)),u=s(n(853)),l=s(n(784));function s(e){return e&&e.__esModule?e:{default:e}}function d(){return(d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}},813:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){var n=t.comment,r=t.posts,l=t.reply,f=d((0,a.useState)(!1),2),p=f[0],m=f[1],_=(0,o.useSelector)((function(e){return(0,i.getUserInfo)(e)})),h=(0,o.useStore)(),v=function(e){return(0,c.like)(e)(h.dispatch,h.getState)},y=n||l||r;if(_&&y.user_id&&y.user_id._id&&y.user_id._id==_._id)return null;if(p)return a.default.createElement(u.default,null);var g=function(){var t,a=(t=regeneratorRuntime.mark((function t(a){var o,i,u,s,f,p,y,g,b,w;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.stopPropagation(),i=(o=n||l||r).like,o.like_count,u=o._id,s="",_){t.next=7;break}return e("#sign").modal({show:!0},{"data-type":"sign-in"}),t.abrupt("return");case 7:if(s=n?"comment":l?"reply":"posts",m(!0),!i){t.next=19;break}return t.next=12,k={type:s,target_id:u},(0,c.unlike)(k)(h.dispatch,h.getState);case 12:f=t.sent,p=d(f,2),y=p[0],p[1],y&&Toastify({text:y,duration:3e3,backgroundColor:"linear-gradient(to right, #ff6c6c, #f66262)"}).showToast(),t.next=26;break;case 19:return t.next=21,v({type:s,target_id:u,mood:1});case 21:g=t.sent,b=d(g,2),w=b[0],b[1],w&&Toastify({text:w,duration:3e3,backgroundColor:"linear-gradient(to right, #ff6c6c, #f66262)"}).showToast();case 26:m(!1);case 27:case"end":return t.stop()}var k}),t)})),function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function i(e){s(o,r,a,i,c,"next",e)}function c(e){s(o,r,a,i,c,"throw",e)}i(void 0)}))});return function(e){return a.apply(this,arguments)}}();return a.default.createElement("span",{onClick:g,className:"a text-secondary"},y.like?"已赞":"赞")};var r,a=function(e){if(e&&e.__esModule)return e;var t=l();if(t&&t.has(e))return t.get(e);var n={};if(null!=e){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=r?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}}n.default=e,t&&t.set(e,n);return n}(n(0)),o=n(168),i=n(78),c=n(851),u=(r=n(783))&&r.__esModule?r:{default:r};function l(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}function s(e,t,n,r,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,a)}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n(736)}).call(this,n(68))},814:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.removeBlock=t.addBlock=t.loadBlockList=void 0;var r=a(n(48));function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(e,t,n,r,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,a)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function c(e){i(o,r,a,c,u,"next",e)}function u(e){i(o,r,a,c,u,"throw",e)}c(void 0)}))}}var u=(0,a(n(117)).default)({reducerName:"block",actionType:"SET_BLOCK_LIST_BY_ID",api:"blocks",fields:"\n    _id\n    deleted\n    create_at\n    ip\n    user_id\n    comment_id {\n      _id\n      content_html\n      posts_id\n      parent_id\n    }\n    people_id {\n      create_at\n      avatar\n      _id\n      nickname\n      avatar_url\n      id\n    }\n    posts_id {\n      title\n      _id\n    }\n  "});t.loadBlockList=u;t.addBlock=function(e){var t=e.args;return function(e,n){return new Promise(function(){var a=c(regeneratorRuntime.mark((function a(i){var c,u,l,s,d;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,(0,r.default)({type:"mutation",apis:[{api:"addBlock",args:t,fields:"\n          success\n          _id  \n          "}],headers:{accessToken:n().user.accessToken}});case 2:if(c=a.sent,u=o(c,2),l=u[0],s=u[1],i([l,s]),!l&&s&&s.success){a.next=9;break}return a.abrupt("return");case 9:d=n().user.userInfo,t.people_id?d.block_people_count?d.block_people_count+=1:d.block_people_count=1:t.posts_id?(d.block_posts_count?d.block_posts_count+=1:d.block_posts_count=1,e({type:"REMOVE_POSTS_BY_ID",id:t.posts_id})):t.comment_id&&(d.block_comment_count?d.block_comment_count+=1:d.block_comment_count=1,e({type:"REMOVE_COMMENT_BY_ID",id:t.comment_id})),e({type:"SET_USER",userinfo:d}),e({type:"SET_BLOCK_STATE",state:{}});case 13:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}())}};t.removeBlock=function(e){var t=e.args,n=e.id;return function(e,a){return new Promise(function(){var i=c(regeneratorRuntime.mark((function i(c){var u,l,s,d,f;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return u=a().user,i.next=3,(0,r.default)({type:"mutation",apis:[{api:"removeBlock",args:t,fields:"success"}],headers:{accessToken:u.accessToken}});case 3:if(l=i.sent,s=o(l,2),d=s[0],f=s[1],c([d,f]),!d&&f&&f.success){i.next=10;break}return i.abrupt("return");case 10:e({type:"REMOVE_BLOCK_BY_ID",id:n}),t.people_id?u.userInfo.block_people_count-=1:t.posts_id?u.userInfo.block_posts_count-=1:t.comment_id&&(u.userInfo.block_comment_count-=1),e({type:"SET_USER",userinfo:u.userInfo});case 13:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}())}}},850:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.comment,n=e.postsAuthorId,p=(0,i.useStore)(),m=(b=(0,r.useState)(!1),w=2,function(e){if(Array.isArray(e))return e}(b)||function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}}(b,w)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()),h=m[0],v=m[1],y=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v(!0),n=t.reply[t.reply.length-1],e.next=4,(0,c.loadMoreReply)({postsId:n.posts_id._id||n.posts_id,commentId:n.parent_id._id||n.parent_id})(p.dispatch,p.getState);case 4:v(!1);case 5:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){_(o,r,a,i,c,"next",e)}function c(e){_(o,r,a,i,c,"throw",e)}i(void 0)}))});return function(e){return t.apply(this,arguments)}}(),g=function(e){e.stopPropagation()};var b,w;return function e(t,i){var c=null;return t.reply_id&&t.reply_id.user_id&&t.reply_id.user_id._id&&(c=t.reply_id.user_id),r.default.createElement("div",{key:t._id,className:"border-top YWfdX"},r.default.createElement("div",{className:"d-flex justify-content-between _2Jecs"},r.default.createElement("div",null,r.default.createElement(a.Link,{to:"/people/".concat(t.user_id._id),className:"text-dark"},r.default.createElement("div",{className:"load-demand _1lnrT","data-load-demand":'<img width="48" height="48" src="'.concat(t.user_id.avatar_url,'" />')}),r.default.createElement("b",{className:"_1eFKs"},t.user_id.nickname),n&&t.user_id._id==n?r.default.createElement("small",null," (楼主)"):null),!i&&c&&c._id!=t.user_id._id||i&&c&&i.user_id._id!=c._id?r.default.createElement("span",{className:"text-muted"},r.default.createElement("svg",{width:"14",height:"14",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"ml-1 mr-1"},r.default.createElement("use",{xlinkHref:"/feather-sprite.svg#chevron-right"})),r.default.createElement(a.Link,{to:"/people/".concat(c._id),onClick:g,className:"text-dark"},r.default.createElement("b",{className:"_1eFKs"},c.nickname))):null)),t.content_html?r.default.createElement("div",{className:"_33PBL"},r.default.createElement(l.default,{content:t.content_html,maxHeight:o.default.comment.contentMaxHeight})):null,r.default.createElement("div",{className:"_24tfM"},r.default.createElement("div",{className:"d-flex justify-content-between"},r.default.createElement("div",{className:"w-50 text-muted _1r4C2"},t.parent_id?r.default.createElement("span",{className:"text-muted"},t._create_at):r.default.createElement(a.Link,{to:"/comment/".concat(t._id),className:"text-muted"},t._create_at),t.like_count?r.default.createElement("span",null,t.like_count," 人赞"):null),r.default.createElement("div",{className:"text-secondary _1PiHO"},t.parent_id?r.default.createElement(u.default,{reply:t}):r.default.createElement(u.default,{comment:t}),r.default.createElement(d.default,{comment:t}),r.default.createElement(s.default,{comment:t})))),t.reply&&t.reply.length>0?r.default.createElement("div",{className:"Oa08p"},t.reply.map((function(n){return e(n,t)})),!h&&t.reply_count>t.reply.length?r.default.createElement("div",{className:"border-top _2RZkO"},r.default.createElement("span",{className:"a text-primary",onClick:function(){return y(t)}},"还有 ",t.reply_count-t.reply.length," 条评论")):null,h?r.default.createElement(f.default,null):null):null)}(t)};var r=function(e){if(e&&e.__esModule)return e;var t=m();if(t&&t.has(e))return t.get(e);var n={};if(null!=e){var r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var o=r?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(n,a,o):n[a]=e[a]}}n.default=e,t&&t.set(e,n);return n}(n(0)),a=n(115),o=p(n(119));n(735);var i=n(168),c=n(792),u=p(n(813)),l=p(n(787)),s=p(n(807)),d=p(n(852)),f=p(n(783));function p(e){return e&&e.__esModule?e:{default:e}}function m(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return m=function(){return e},e}function _(e,t,n,r,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,a)}},851:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unlike=t.like=void 0;var r,a=(r=n(48))&&r.__esModule?r:{default:r};function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(e,t,n,r,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void n(e)}c.done?t(u):Promise.resolve(u).then(r,a)}var c=function(e){return function(t){return function(n,r){return new Promise(function(){var c,u=(c=regeneratorRuntime.mark((function i(c){var u,l,s,d;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return t.status=e,i.next=3,(0,a.default)({type:"mutation",apis:[{api:"like",args:t,fields:"success"}],headers:{accessToken:r().user.accessToken}});case 3:if(u=i.sent,l=o(u,2),s=l[0],d=l[1],!s){i.next=9;break}return i.abrupt("return",c([s?s.message:"未知错误"]));case 9:"comment"==t.type||"reply"==t.type?n({type:"UPDATE_COMMENT_LIKE",id:t.target_id,status:e}):"posts"==t.type&&n({type:"UPDATE_POSTS_LIKE_STATUS",id:t.target_id,status:e}),c([null,d]);case 11:case"end":return i.stop()}}),i)})),function(){var e=this,t=arguments;return new Promise((function(n,r){var a=c.apply(e,t);function o(e){i(a,n,r,o,u,"next",e)}function u(e){i(a,n,r,o,u,"throw",e)}o(void 0)}))});return function(e){return u.apply(this,arguments)}}())}}},u=c(!0);t.like=u;var l=c(!1);t.unlike=l},852:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){var n=t.reply,r=t.comment,c=t.posts,u=(0,o.useSelector)((function(e){return(0,i.getUserInfo)(e)})),l=c?"评论":"回复";return a.default.createElement("span",{className:"a text-secondary",onClick:u?function(t){if(t.stopPropagation(),u){var a="reply";c&&(a="comment"),e("#editor-comment-modal").modal({show:!0},{type:a,comment:r||n||null,posts:c})}else e("#sign").modal({show:!0},{})}:function(t){e("#sign").modal("show"),t.stopPropagation()}},l)};var r,a=(r=n(0))&&r.__esModule?r:{default:r},o=n(168),i=n(78);n(738)}).call(this,n(68))},853:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.item,n=(0,o.default)().history;return r.default.createElement("div",{className:"card-body border-bottom",onClick:function(){return n.push("/comment/".concat(t._id))}},r.default.createElement("div",{className:"text-secondary"},"评论了 ",r.default.createElement(a.Link,{to:t.posts_id._id,className:"text-primary",onClick:function(e){e.stopPropagation()}},t.posts_id.title)),t.content_summary,r.default.createElement("div",{className:"text-muted _1OrQa"},r.default.createElement("span",null,t._create_at),t.reply_count?r.default.createElement("span",null,t.reply_count,"人回复"):null,t.like_count?r.default.createElement("span",null,t.like_count,"人赞"):null))};var r=i(n(0)),a=n(115),o=i(n(277));function i(e){return e&&e.__esModule?e:{default:e}}n(739)}}]);