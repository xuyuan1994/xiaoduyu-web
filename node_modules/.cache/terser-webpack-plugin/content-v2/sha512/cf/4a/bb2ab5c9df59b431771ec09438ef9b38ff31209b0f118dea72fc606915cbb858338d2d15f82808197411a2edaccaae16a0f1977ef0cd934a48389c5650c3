{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{758:function(e,t,n){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var a=_(n(0)),r=y(n(277)),l=y(n(866)),o=_(n(292)),i=n(168),c=n(806),u=n(290),d=y(n(779)),s=y(n(780)),f=y(n(783)),m=y(n(803)),p=y(n(867)),v=y(n(868));function y(e){return e&&e.__esModule?e:{default:e}}function h(){if(\"function\"!=typeof WeakMap)return null;var e=new WeakMap;return h=function(){return e},e}function _(e){if(e&&e.__esModule)return e;var t=h();if(t&&t.has(e))return t.get(e);var n={};if(null!=e){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var l=a?Object.getOwnPropertyDescriptor(e,r):null;l&&(l.get||l.set)?Object.defineProperty(n,r,l):n[r]=e[r]}}return n.default=e,t&&t.set(e,n),n}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e)))return;var n=[],a=!0,r=!1,l=void 0;try{for(var o,i=e[Symbol.iterator]();!(a=(o=i.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){r=!0,l=e}finally{try{a||null==i.return||i.return()}finally{if(r)throw l}}return n}(e,t)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}()}n(760);var w=null,E=(0,d.default)((function(t){var n=t.setNotFound,d=((0,r.default)().match.params||{}).id,y=(0,a.useRef)(),h=g((0,a.useState)(!0),2),_=h[0],E=h[1],b=g((0,a.useState)(!1),2),k=b[0],N=b[1],O=g((0,a.useState)(!1),2),j=O[0],C=O[1],x=g((0,a.useState)(!1),2),P=x[0],S=x[1],I=(0,i.useSelector)((function(e){return(0,u.getLiveListById)(e,d)})),M=(0,i.useStore)(),T=function(e){o.isiOSWechat()?N(!0):o.isAndroidWechat()?C(!0):e.status&&function(e){e.status;var t=e._id;e.user_id;return new Promise((function(e){if(window.AgoraRTC)e((0,l.default)(window.AgoraRTC,t));else{var n=document.getElementsByTagName(\"head\").item(0),a=document.createElement(\"script\");a.onload=function(){e((0,l.default)(window.AgoraRTC,t))},a.type=\"text/javascript\",a.src=\"/agora/AgoraRTCSDK-2.8.0.js\",n.appendChild(a)}}))}(e).then((function(e){if(e){var t=e.play;e.stop;o.isSafari()?w=t:S(!0)}else E(!1)}))},A=function(){var t=e(window).width(),n=Math.ceil((t-365)/835*650);t<=767?(e(y.current).css(\"width\",\"\"),e(y.current).css(\"height\",\"\"),e(\"#video\").css(\"height\",\"\")):n<650?(e(y.current).css(\"width\",t+\"px\"),e(y.current).css(\"height\",n+\"px\"),e(\"#video\").css(\"height\",n-80+\"px\")):(e(y.current).css(\"width\",\"\"),e(y.current).css(\"height\",\"650px\"),e(\"#video\").css(\"height\",\"570px\"))};(0,a.useEffect)((function(){e(window).resize((function(){A()})),setTimeout((function(){A()}),500);var t,a=I&&I.data&&I.data[0]?I.data[0]:null;a?I&&I.data&&!I.data[0]?n(\"404 live不存在\"):(a=I.data[0],T(a)):(t={id:d,args:{_id:d}},(0,c.loadLiveList)(t)(M.dispatch,M.getState)).then((function(e){var t=g(e,2),r=(t[0],t[1]);r&&r.data&&r.data[0]?(a=r.data[0],T(a)):n(\"live不存在\")}))}),[d]);var D=I||{},L=D.loading,R=D.data,U=R&&R[0]?R[0]:null;return L||!U?a.default.createElement(\"div\",{className:\"text-center\"},a.default.createElement(f.default,null)):k?a.default.createElement(\"div\",{className:\"container text-center\"},a.default.createElement(\"div\",{style:{width:\"240px\",margin:\"20px auto 20px auto\"}},\"因微信内置浏览器不支持WebRCT，需要使用手机自带浏览器观看直播，操作方法如下图。\"),a.default.createElement(\"div\",null,a.default.createElement(\"img\",{style:{borderRadius:\"8px\"},src:\"/share-to-safari.png\",width:\"200\"}))):j?a.default.createElement(\"div\",{className:\"container text-center\"},a.default.createElement(\"div\",{style:{width:\"240px\",margin:\"20px auto 20px auto\"}},\"因微信内置浏览器不支持WebRCT，需要下载小度鱼APP，才能观看直播\",a.default.createElement(\"div\",null,a.default.createElement(\"a\",{href:\"/app/xiaoduyu/\",className:\"btn btn-primary mt-3\"},\"下载APP，观看直播\")))):_?a.default.createElement(\"div\",{className:\"_2MxKD\",ref:y},a.default.createElement(s.default,{title:U.user_id.nickname+\"直播间：\"+U.title}),a.default.createElement(\"div\",{className:\"by-Py\"},a.default.createElement(\"div\",{className:\"card rounded-left mb-0\"},a.default.createElement(\"div\",{className:\"card-header p-0 d-flex justify-content-between\"},a.default.createElement(\"div\",{className:\"d-flex flex-row align-items-center\"},a.default.createElement(\"img\",{className:\"_pwnS\",src:U.user_id.avatar_url}),a.default.createElement(\"div\",null,a.default.createElement(\"div\",null,a.default.createElement(\"b\",null,U.user_id.nickname)),a.default.createElement(\"div\",null,U.title),a.default.createElement(p.default,U))),a.default.createElement(\"div\",{className:\"pt-4 pr-3\"},a.default.createElement(m.default,{live:U}))),a.default.createElement(\"div\",{className:\"card-body p-0 _1aiQK\",id:\"video\"},U.status?a.default.createElement(\"span\",{className:\"YJsrJ\",onClick:function(){w(),S(!0)}},a.default.createElement(\"svg\",{width:\"28\",height:\"28\",stroke:\"currentColor\",strokeWidth:\"2\",strokeLinecap:\"round\",strokeLinejoin:\"round\"},a.default.createElement(\"use\",{xlinkHref:\"/feather-sprite.svg#play\"}))):a.default.createElement(\"div\",{className:\"xLF4_\"},a.default.createElement(\"h5\",null,\"直播预告\"),a.default.createElement(\"div\",null,U.notice))))),a.default.createElement(\"div\",{className:\"_2bvYp\"},a.default.createElement(\"div\",{className:\"card rounded-right border-left\"},a.default.createElement(\"div\",{className:\"card-body p-0\"},U.status&&P?a.default.createElement(v.default,{liveId:U._id}):null)))):a.default.createElement(\"div\",{className:\"container\"},a.default.createElement(\"div\",null,a.default.createElement(\"a\",{href:\"/app/xiaoduyu\"},\"你的浏览器不支持WebRTC，请使用Chrome或Safari浏览器，请下载APP观看直播\")))}));t.default=E}).call(this,n(68))},779:function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=function(e){var t=function(t){t.history;var n=t.location,u=t.match;t.staticContext;\"undefined\"!=typeof window&&l.set(\"history\",(0,r.default)().history);var d,s,f=(0,a.useState)(\"\"),m=(s=2,function(e){if(Array.isArray(e))return e}(d=f)||function(e,t){if(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e)){var n=[],a=!0,r=!1,l=void 0;try{for(var o,i=e[Symbol.iterator]();!(a=(o=i.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){r=!0,l=e}finally{try{a||null==i.return||i.return()}finally{if(r)throw l}}return n}}(d,s)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}()),p=m[0],v=m[1],y=(0,o.useStore)(),h=n.pathname,_=n.search;return n.params=_?(0,c.default)(_):{},(0,a.useEffect)((function(){return\"undefined\"!=typeof window&&\"/\"!=window.location.pathname&&(0,i.setScrollPosition)(h+_)(y.dispatch,y.getState),function(){\"undefined\"!=typeof window&&l.remove(\"history\")}}),[]),p?a.default.createElement(\"div\",{className:\"container text-center\"},p):a.default.createElement(e,{match:u,setNotFound:v})};return t.loadDataOnServer=e.loadDataOnServer||function(){return{code:200}},t};var a=s(n(0)),r=u(n(277)),l=s(n(116)),o=n(168),i=n(278),c=u(n(781));function u(e){return e&&e.__esModule?e:{default:e}}function d(){if(\"function\"!=typeof WeakMap)return null;var e=new WeakMap;return d=function(){return e},e}function s(e){if(e&&e.__esModule)return e;var t=d();if(t&&t.has(e))return t.get(e);var n={};if(null!=e){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var l=a?Object.getOwnPropertyDescriptor(e,r):null;l&&(l.get||l.set)?Object.defineProperty(n,r,l):n[r]=e[r]}}return n.default=e,t&&t.set(e,n),n}},780:function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=function(e){var t=e.title,n=e.children,a=(0,o.useSelector)((function(e){return(0,i.getUnreadNotice)(e)})),d=(0,o.useSelector)((function(e){return(0,c.getTipsById)(e,\"home\")||(0,c.getTipsById)(e,\"feed\")||(0,c.getTipsById)(e,\"favorite\")||(0,c.getTipsById)(e,\"excellent\")})),s=(0,o.useSelector)((function(e){return(0,c.getTipsById)(e,\"unread-message\")})),f=\"\";s&&(f+=\"(\".concat(s,\"条私信) \"));a&&a.length>0&&(f+=\"(\".concat(a.length,\"条通知) \"));d&&(f+=\"(有新动态) \");f+=t||u.name,t&&(f+=\" - \".concat(u.name));return r.default.createElement(r.default.Fragment,null,r.default.createElement(l.ReactTitle,{title:f}),n?r.default.createElement(l.default,null,n):null)};var a,r=(a=n(0))&&a.__esModule?a:{default:a},l=function(e){if(e&&e.__esModule)return e;var t=d();if(t&&t.has(e))return t.get(e);var n={};if(null!=e){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var l=a?Object.getOwnPropertyDescriptor(e,r):null;l&&(l.get||l.set)?Object.defineProperty(n,r,l):n[r]=e[r]}}n.default=e,t&&t.set(e,n);return n}(n(691)),o=n(168),i=n(169),c=n(170),u=n(77);function d(){if(\"function\"!=typeof WeakMap)return null;var e=new WeakMap;return d=function(){return e},e}},781:function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var a=function(e){return e.substr(1).split(\"&\").reduce((function(e,t){if(t){var n=t.split(\"=\");e[n[0]]=n[1]||\"\"}return e}),{})};t.default=a},783:function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=function(e){e.size,e.position;return r.default.createElement(\"span\",{className:\"_3H7UH\"})};var a,r=(a=n(0))&&a.__esModule?a:{default:a};n(693)},796:function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var a={};a.in=\"undefined\"!=typeof window&&\"undefined\"!=typeof document&&\"micromessenger\"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i);var r=a;t.default=r},803:function(e,t,n){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=function(t){var n=t.posts,i=t.comment,c=t.live,d=t.styleType,s=u((0,a.useState)(!1),2),f=s[0],m=s[1],p=u((0,a.useState)(!1),2),v=p[0],y=p[1],h=\"\",_=\"\",g=\"\";n?(h=n.title,_=n.content_summary,n._coverImage||\"\",g=l.domainName+\"/posts/\"+n._id):i?(h=i.posts_id.title,_=i.content_summary,i._coverImage||\"\",g=l.domainName+\"/comment/\"+i._id):c&&(h=c.user_id.nickname+\"的直播间\",_=c.title,c.cover_image||\"\",g=l.domainName+\"/live/\"+c._id);var w=function(){g+=\"?from_share=weibo\",window.open(\"http://service.weibo.com/share/share.php?url=\".concat(encodeURIComponent(g),\"&title=\").concat(encodeURIComponent(h)),\"_blank\",\"width=550,height=370\")},E=function(){g+=\"?from_share=qzone\",window.open(\"https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=\".concat(encodeURIComponent(g),\"&title=\").concat(encodeURIComponent(h),\"&desc=\").concat(encodeURIComponent(\"来自\"+l.name+\" \"+l.domainName),\"&summary=\").concat(encodeURIComponent(_),\"&site=\").concat(encodeURIComponent(l.name)),\"_blank\",\"width=590,height=370\")},b=function(){g+=\"?from_share=qq\",window.open(\"https://connect.qq.com/widget/shareqq/index.html?url=\".concat(encodeURIComponent(g),\"&title=\").concat(h,\"&desc=&summary=\").concat(encodeURIComponent(_),\"&site=\").concat(encodeURIComponent(l.name)),\"_blank\",\"width=770,height=620\")},k=function(){g+=\"?from_share=facebook\",window.open(\"https://www.facebook.com/sharer/sharer.php?u=\".concat(encodeURIComponent(g),\"&t=\").concat(h),\"_blank\",\"width=770,height=620\")},N=function(){g+=\"?from_share=twitter\",window.open(\"https://twitter.com/intent/tweet?text=\".concat(h,\"&url=\").concat(encodeURIComponent(g)),\"_blank\",\"width=770,height=620\")},O=function(){o.default.in?m(!0):y(!0)},j=function(e){y(e)},C=function(e){m(e)};if(\"icons\"==d)return a.default.createElement(\"div\",null,a.default.createElement(\"div\",{className:\"_3bezE\"},a.default.createElement(\"span\",{className:\"a _1Hb5x\",onClick:O}),a.default.createElement(\"span\",{className:\"a _33lE4\",onClick:w}),a.default.createElement(\"span\",{className:\"a _384yp\",onClick:E}),a.default.createElement(\"span\",{className:\"a _2Tml9\",onClick:b}),a.default.createElement(\"span\",{className:\"a _1zLkZ\",onClick:N}),a.default.createElement(\"span\",{className:\"a _3mZlN\",onClick:k})),a.default.createElement(\"div\",null,v?a.default.createElement(\"div\",{className:\"DsKCT\",onClick:function(){j(!1)}}):null,v?a.default.createElement(\"div\",{className:\"_2LUT8\"},a.default.createElement(r.default,{value:\"\".concat(g,\"?_s=weixin\")}),a.default.createElement(\"div\",null,\"微信扫一扫，分享\")):null,a.default.createElement(\"div\",{className:\"_3hzq5\",style:{display:f?\"block\":\"none\"},onClick:function(){C(!1)}},a.default.createElement(\"div\",null,\"点击右上角 ... 按钮，\",a.default.createElement(\"br\",null),\"将此页面分享给你的朋友或朋友圈\"))));return a.default.createElement(\"div\",{className:\"_1jwjw\"},a.default.createElement(\"span\",{\"data-toggle\":\"dropdown\",\"aria-haspopup\":\"true\",\"aria-expanded\":\"false\",className:\"a text-secondary\"},\"分享\"),a.default.createElement(\"div\",null,a.default.createElement(\"div\",{className:\"dropdown-menu\",\"aria-labelledby\":\"share-dropdown\"},a.default.createElement(\"span\",{className:\"a dropdown-item _1z7AA\",onClick:function(){var t=e(\"<textarea>\"+(g+=\"?from_share=link\")+\"</textarea>\");e(\"body\").append(t),t[0].select(),document.execCommand(\"Copy\"),t.remove(),Toastify({text:\"复制成功\",duration:3e3,backgroundColor:\"linear-gradient(to right, #50c64a, #40aa33)\"}).showToast()}},\"复制连接\"),a.default.createElement(\"span\",{className:\"a dropdown-item _1Hb5x\",onClick:O},\"微信\"),a.default.createElement(\"span\",{className:\"a dropdown-item _33lE4\",onClick:w},\"微博\"),a.default.createElement(\"span\",{className:\"a dropdown-item _384yp\",onClick:E},\"QQ空间\"),a.default.createElement(\"span\",{className:\"a dropdown-item _2Tml9\",onClick:b},\"QQ好友和群组\"),a.default.createElement(\"span\",{className:\"a dropdown-item _1zLkZ\",onClick:N},\"Twitter\"),a.default.createElement(\"span\",{className:\"a dropdown-item _3mZlN\",onClick:k},\"Facebook\")),v?a.default.createElement(\"div\",{className:\"DsKCT\",onClick:function(){j(!1)}}):null,v?a.default.createElement(\"div\",{className:\"_2LUT8\"},a.default.createElement(r.default,{value:\"\".concat(g,\"?_s=weixin\")}),a.default.createElement(\"div\",null,\"微信扫一扫，分享\")):null,a.default.createElement(\"div\",{className:\"_3hzq5\",style:{display:f?\"block\":\"none\"},onClick:function(){C(!1)}},a.default.createElement(\"div\",null,\"点击右上角 ... 按钮，\",a.default.createElement(\"br\",null),\"将此页面分享给你的朋友或朋友圈\"))))};var a=function(e){if(e&&e.__esModule)return e;var t=c();if(t&&t.has(e))return t.get(e);var n={};if(null!=e){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var l=a?Object.getOwnPropertyDescriptor(e,r):null;l&&(l.get||l.set)?Object.defineProperty(n,r,l):n[r]=e[r]}}n.default=e,t&&t.set(e,n);return n}(n(0)),r=i(n(694)),l=n(77),o=i(n(796));function i(e){return e&&e.__esModule?e:{default:e}}function c(){if(\"function\"!=typeof WeakMap)return null;var e=new WeakMap;return c=function(){return e},e}function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e)))return;var n=[],a=!0,r=!1,l=void 0;try{for(var o,i=e[Symbol.iterator]();!(a=(o=i.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){r=!0,l=e}finally{try{a||null==i.return||i.return()}finally{if(r)throw l}}return n}(e,t)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}()}n(703)}).call(this,n(68))},806:function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.removeAudienceCount=t.addAudienceCount=t.loadLiveList=void 0;var a,r=n(171);var l=(0,((a=n(117))&&a.__esModule?a:{default:a}).default)({reducerName:\"live\",actionType:\"ADD_LIVE_LIST_BY_ID\",processList:function(e,t,n){return e.map((function(e){e.last_time&&(e._last_time=(0,r.dateDiff)(e.last_time))})),e},api:\"live\",fields:\"\\n    _id\\n    user_id{\\n      _id\\n      nickname\\n      avatar_url\\n    }\\n    title\\n    notice\\n    cover_image\\n    create_at\\n    last_time\\n    status\\n    audience_count\\n    view_count\\n    talk_count\\n  \"});t.loadLiveList=l;t.addAudienceCount=function(e){return function(t,n){console.log(\"=================\"),t({type:\"ADD_AUDIENCE_BY_LIVE_ID\",id:e})}};t.removeAudienceCount=function(e){return function(t,n){t({type:\"REMOVE_AUDIENCE_BY_LIVE_ID\",id:e})}}},866:function(e,t,n){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=function(t,n){if(!t.checkSystemRequirements())return!1;var l,o=[];return(l=t.createClient({mode:\"live\"})).init(a.agora.appid,(function(){l.join(null,n,null,(function(e){}),(function(e){console.log(\"Join channel failed\",e)}))}),(function(e){console.log(\"AgoraRTC client init failed\",e)})),l.on(\"stream-added\",(function(e){var t=e.stream;console.log(\"New stream added: \"+t.getId()),console.log(\"Subscribe \",t),l.subscribe(t,(function(e){console.log(\"Subscribe stream failed\",e)}))})),l.on(\"stream-subscribed\",(function(t){var n=t.stream;if(0===e(\"div#video #agora_remote\"+n.getId()).length){var a=\"\";n.video||(a=\"display:none\"),e(\"div#video\").append('<div id=\"agora_remote'+n.getId()+'\" style=\"'+a+'\"></div>')}r.isSafari()?o.push(n):n.play(\"agora_remote\"+n.getId())})),l.on(\"stream-removed\",(function(t){var n=t.stream;n.stop(),e(\"#agora_remote\"+n.getId()).remove(),console.log(\"Remote stream is removed \"+n.getId())})),l.on(\"peer-leave\",(function(t){var n=t.stream;n&&(n.stop(),e(\"#agora_remote\"+n.getId()).remove(),console.log(t.uid+\" leaved from this channel\"))})),l.on(\"first-audio-frame-decode\",(function(e){console.log(\"音频回调函数\")})),{play:function(){o.map((function(e){e.play(\"agora_remote\"+e.getId())}))},stop:function(){o.map((function(e){e.stop()}))}}};var a=n(77),r=function(e){if(e&&e.__esModule)return e;var t=l();if(t&&t.has(e))return t.get(e);var n={};if(null!=e){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var o=a?Object.getOwnPropertyDescriptor(e,r):null;o&&(o.get||o.set)?Object.defineProperty(n,r,o):n[r]=e[r]}}n.default=e,t&&t.set(e,n);return n}(n(292));function l(){if(\"function\"!=typeof WeakMap)return null;var e=new WeakMap;return l=function(){return e},e}}).call(this,n(68))},867:function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=function(e){var t=e.view_count,n=e.talk_count,a=e.audience_count;return r.default.createElement(\"div\",{className:\"text-secondary\"},t?r.default.createElement(\"span\",{className:\"mr-3\"},r.default.createElement(l,{name:\"eye\"}),t):null,n?r.default.createElement(\"span\",{className:\"mr-3\"},r.default.createElement(l,{name:\"message-square\"}),n):null,a?r.default.createElement(\"span\",{className:\"mr-3\"},r.default.createElement(l,{name:\"user\"}),a):null)};var a,r=(a=n(0))&&a.__esModule?a:{default:a};var l=function(e){var t=e.name;return r.default.createElement(\"svg\",{width:\"14\",height:\"14\",fill:\"none\",stroke:\"currentColor\",strokeWidth:\"2\",strokeLinecap:\"round\",strokeLinejoin:\"round\",className:\"mr-1\"},r.default.createElement(\"use\",{xlinkHref:\"/feather-sprite.svg#\".concat(t)}))}},868:function(e,t,n){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=function(t){var n=t.liveId,u=(0,l.useStore)(),d=(0,a.useRef)(),p=s((0,a.useReducer)(m,f),2),v=p[0],y=p[1],h=(0,l.useSelector)((function(e){return(0,i.getUserInfo)(e)})),_=s((0,a.useState)(!1),2),g=(_[0],_[1],function(e){var t=e.type,a=void 0===t?\"text\":t,r=e.messageText;h&&o.emit(\"message\",{target:n,data:{type:a,user:{_id:h._id,nickname:h.nickname,avatar_url:h.avatar_url},text:r}})});(0,a.useEffect)((function(){if(n){o.emit(\"live\",{type:\"join-room\",liveId:n}),g({type:\"welcome\"});var t=!0;return e(\"#live-\".concat(n)).on(\"mousewheel\",(function(){var a=e(\"#live-\".concat(n)).prop(\"scrollHeight\"),r=e(\"#live-\".concat(n)).scrollTop(),l=e(\"#live-\".concat(n)).height();t=r+l+70>=a})),o.addListener(n,(function(a){if(a&&\"add-audience\"==a.type)(0,c.addAudienceCount)(n)(u.dispatch,u.getState);else if(a&&\"remove-audience\"==a.type)(0,c.removeAudienceCount)(n)(u.dispatch,u.getState);else try{y({type:\"add\",data:a});var r=e(\"#live-\".concat(n)).prop(\"scrollHeight\");if(!t)return;e(\"#live-\".concat(n)).scrollTop(r,200)}catch(e){console.log(e)}})),function(){n&&o.emit(\"live\",{type:\"leave-room\",liveId:n})}}}),[]);return a.default.createElement(\"div\",null,a.default.createElement(\"div\",{id:\"live-\".concat(n),className:\"_3k7D7\"},v.map((function(e,t){if(e&&e.type){var n=null;switch(e.type){case\"text\":n=a.default.createElement(a.default.Fragment,null,e.user?a.default.createElement(\"span\",null,a.default.createElement(\"img\",{className:\"_3_vo3\",src:e.user.avatar_url}),a.default.createElement(r.Link,{to:\"/people/\".concat(e.user._id),className:\"text-primary\"},e.user.nickname),\": \"):null,e.text);break;case\"welcome\":n=\"欢迎 \".concat(e.user?e.user.nickname:\"未知\",\" 加入直播间！\");break;case\"notice\":n=a.default.createElement(\"div\",{className:\"text-danger\"},e.text)}return a.default.createElement(\"div\",{key:t},n)}}))),h?a.default.createElement(\"form\",{className:\"border-top _3DLme\",onSubmit:function(e){e&&e.preventDefault();var t=d.current.value;if(t){if(t.length>60)return void alert(\"发言内容，最多30个字符\");g({messageText:t}),d.current.value=\"\"}else d.current.focus()}},a.default.createElement(\"input\",{type:\"text\",className:\"_2mUvM\",ref:d}),a.default.createElement(\"button\",{className:\"btn btn-primary mL3C3\"},\"发送\")):a.default.createElement(\"div\",{className:\"d-flex align-items-center justify-content-center border-top _3DLme\"},a.default.createElement(\"span\",{\"data-toggle\":\"modal\",\"data-target\":\"#sign\",\"data-type\":\"sign-up\",className:\"a text-primary\"},\"登录发言，参与交流\")))};var a=d(n(0)),r=n(115),l=n(168),o=d(n(299)),i=n(78),c=n(806);function u(){if(\"function\"!=typeof WeakMap)return null;var e=new WeakMap;return u=function(){return e},e}function d(e){if(e&&e.__esModule)return e;var t=u();if(t&&t.has(e))return t.get(e);var n={};if(null!=e){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var l=a?Object.getOwnPropertyDescriptor(e,r):null;l&&(l.get||l.set)?Object.defineProperty(n,r,l):n[r]=e[r]}}return n.default=e,t&&t.set(e,n),n}function s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e)))return;var n=[],a=!0,r=!1,l=void 0;try{for(var o,i=e[Symbol.iterator]();!(a=(o=i.next()).done)&&(n.push(o.value),!t||n.length!==t);a=!0);}catch(e){r=!0,l=e}finally{try{a||null==i.return||i.return()}finally{if(r)throw l}}return n}(e,t)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}()}n(759);var f=[{type:\"notice\",text:\"系统公告：禁止低俗、暴露、辱骂他人、宗教、邪教迷信、直播聚众闹事、集会等。违规一律封号。\"}];function m(e,t){switch(t.type){case\"add\":return e.push(t.data),e.length>100&&(e=e.splice(e.length-100,100)),JSON.parse(JSON.stringify(e))}}}).call(this,n(68))}}]);","extractedComments":[]}