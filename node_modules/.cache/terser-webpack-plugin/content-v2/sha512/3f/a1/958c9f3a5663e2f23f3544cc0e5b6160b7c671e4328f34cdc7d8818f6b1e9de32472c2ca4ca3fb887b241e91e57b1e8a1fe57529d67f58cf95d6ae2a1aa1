{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{732:function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=void 0;var n=function(e){if(e&&e.__esModule)return e;var t=_();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var l=n?Object.getOwnPropertyDescriptor(e,a):null;l&&(l.get||l.set)?Object.defineProperty(r,a,l):r[a]=e[a]}}r.default=e,t&&t.set(e,r);return r}(r(0)),a=v(r(277)),l=r(168),o=r(283),i=r(173),u=r(788),c=v(r(793)),d=v(r(779)),s=v(r(780)),f=v(r(783)),p=v(r(849)),m=v(r(797));function v(e){return e&&e.__esModule?e:{default:e}}function _(){if(\"function\"!=typeof WeakMap)return null;var e=new WeakMap;return _=function(){return e},e}function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(r,!0).forEach((function(t){h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function g(e,t,r,n,a,l,o){try{var i=e[l](o),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,a)}function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,l=void 0;try{for(var o,i=e[Symbol.iterator]();!(n=(o=i.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,l=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw l}}return r}(e,t)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}()}var O=(0,d.default)((function(e){var t=e.setNotFound,r=(0,a.default)(),u=(r.history,r.location,r.match),d=(0,l.useSelector)((function(e){return(0,i.getTopicListById)(e,u.params.id)}))||{},v=d.data,_=void 0===v?[]:v,y=d.loading,b=void 0!==y&&y,h=_[0]||null,g=(0,l.useStore)();if((0,n.useEffect)((function(){if(!b){var e,r=u.params.id;h||(e={id:r,args:{_id:r}},(0,o.loadTopicList)(e)(g.dispatch,g.getState)).then((function(e){var r=w(e,2),n=(r[0],r[1]);(!n||n&&n.data&&!n.data[0])&&t(\"话题不存在\")}))}}),[u.params.id]),!h||b)return n.default.createElement(\"div\",{className:\"text-center\"},n.default.createElement(f.default,null));var O=[];return h.children&&h.children.length>0?h.children.map((function(e){O.push(e._id)})):O.push(h._id),O=O.join(\",\"),n.default.createElement(c.default,null,n.default.createElement(\"div\",null,n.default.createElement(s.default,{title:h.name}),n.default.createElement(\"div\",{className:\"card\"},n.default.createElement(\"div\",{className:\"card-header p-4\"},n.default.createElement(p.default,{topic:h})),n.default.createElement(\"div\",{className:\"card-body p-0\"},n.default.createElement(m.default,{id:h._id,query:{sort_by:\"sort_by_date:-1\",deleted:!1,weaken:!1,page_size:30,topic_id:O},scrollLoad:!0})))),n.default.createElement(\"div\",null,n.default.createElement(\"div\",{className:\"card\"},n.default.createElement(\"div\",{className:\"card-header\"},n.default.createElement(\"b\",null,\"最热\")),n.default.createElement(\"div\",{className:\"card-body p-0\"},n.default.createElement(m.default,{id:\"hot-\"+h._id,itemType:\"poor\",query:{topic_id:O,sort_by:\"comment_count:-1,like_count:-1,sort_by_date:-1\",start_create_at:new Date((new Date).getTime()-6048e5)+\"\",deleted:!1,weaken:!1,page_size:10}})))))}));O.loadDataOnServer=function(){var e,t=(e=regeneratorRuntime.mark((function e(t){var r,n,a,l,i,c,d,s,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.store,n=t.match,t.res,t.req,!t.user){e.next=3;break}return e.abrupt(\"return\",{code:200});case 3:return a=n.params.id,e.next=6,(0,o.loadTopicList)({id:a,args:{_id:a}})(r.dispatch,r.getState);case 6:if(c=e.sent,d=w(c,2),l=d[0],i=d[1],l||!i||!i.data||!i.data[0]){e.next=20;break}return i=i.data[0],s=P(n.search),f=[],i.children&&i.children.length>0?i.children.map((function(e){f.push(e._id)})):f.push(i._id),e.next=17,(0,u.loadPostsList)({id:i._id,args:b({sort_by:\"sort_by_date:-1\",deleted:!1,weaken:!1,page_size:30,topic_id:f.join(\",\")},s)})(r.dispatch,r.getState);case 17:return e.abrupt(\"return\",{code:200});case 20:return e.abrupt(\"return\",{code:404,text:\"该话题不存在\"});case 21:case\"end\":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,a){var l=e.apply(t,r);function o(e){g(l,n,a,o,i,\"next\",e)}function i(e){g(l,n,a,o,i,\"throw\",e)}o(void 0)}))});return function(e){return t.apply(this,arguments)}}();var E=O;t.default=E;var P=function(e){var t={};(e.split(\"?\")[1]||\"\").split(\"&\").map((function(e){var r=e.split(\"=\");t[r[0]]=r[1]}));var r={},n={page_number:function(e){return parseInt(e)}};for(var a in t)n[a]&&(r[a]=n[a](t[a]));return r}},789:function(e,t,r){\"use strict\";(function(e){Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=function(t){var r=t.posts,n=t.user,c=t.topic,d=t.className,s=void 0===d?\"btn btn-outline-primary btn-sm rounded-pill\":d,f=t.activeClassName,p=void 0===f?\"btn btn-outline-secondary btn-sm rounded-pill\":f,m=r||n||c,v=(0,l.useSelector)((function(e){return(0,i.getUserInfo)(e)})),_=(0,l.useStore)();if(v&&r&&r.user_id&&r.user_id._id==v._id||v&&n&&n._id==v._id)return\"\";var y=\"关注\",b=a.default.createElement(\"svg\",{width:\"15px\",height:\"15px\",stroke:\"currentColor\",strokeWidth:1.8,strokeLinecap:\"round\",strokeLinejoin:\"round\",fill:\"none\",className:\"mr-1\"},a.default.createElement(\"use\",{xlinkHref:\"/feather-sprite.svg#plus\"}));r&&(y=\"收藏\",b=null);m.follow&&(b=null);return v?m.follow?a.default.createElement(\"span\",{className:p,onClick:function(e){e.stopPropagation();var t={};r&&(t.posts_id=r._id),n&&(t.user_id=n._id),c&&(t.topic_id=c._id),function(e){return(0,o.unfollow)(e)(_.dispatch,_.getState)}({args:t}).then((function(e){var t=u(e,2),r=t[0];t[1];r&&Toastify({text:r,duration:3e3,backgroundColor:\"linear-gradient(to right, #0988fe, #1c75fb)\"}).showToast()}))}},b,\"正在\",y):a.default.createElement(\"span\",{className:s,onClick:function(t){t.stopPropagation();var a={};r&&(a.posts_id=r._id),n&&(a.user_id=n._id),c&&(a.topic_id=c._id),function(e){return(0,o.follow)(e)(_.dispatch,_.getState)}({args:a}).then((function(t){var r=u(t,2),n=r[0];r[1];n&&e.toast({text:n,position:\"top-center\",showHideTransition:\"slide\",icon:\"info\",loader:!1,allowToastClose:!1})}))}},b,y):a.default.createElement(\"span\",{className:s,\"data-toggle\":\"modal\",\"data-target\":\"#sign\",onClick:function(e){e.stopPropagation()}},b,y)};var n,a=(n=r(0))&&n.__esModule?n:{default:n},l=r(168),o=r(794),i=r(78);function u(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,l=void 0;try{for(var o,i=e[Symbol.iterator]();!(n=(o=i.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,l=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw l}}return r}(e,t)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}()}r(699)}).call(this,r(68))},793:function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=function(e){var t=e.children,r=void 0===t?[]:t;return(0,n.useEffect)((function(){var e=FloatFixed({id:\"right-float\",offsetTop:60});return function(){e.remove()}}),[]),n.default.createElement(\"div\",{className:\"container\"},n.default.createElement(\"div\",{className:\"_26ovl\"},n.default.createElement(\"div\",{id:\"center\"},r[0]),n.default.createElement(\"div\",{className:\"_1mclz\"},n.default.createElement(\"div\",{id:\"right\"},r[1]),n.default.createElement(\"div\",null,n.default.createElement(\"div\",{id:\"right-float\",className:\"_3R-zd\"},r[2]||null)))))};var n=function(e){if(e&&e.__esModule)return e;var t=a();if(t&&t.has(e))return t.get(e);var r={};if(null!=e){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if(Object.prototype.hasOwnProperty.call(e,l)){var o=n?Object.getOwnPropertyDescriptor(e,l):null;o&&(o.get||o.set)?Object.defineProperty(r,l,o):r[l]=e[l]}}r.default=e,t&&t.set(e,r);return r}(r(0));function a(){if(\"function\"!=typeof WeakMap)return null;var e=new WeakMap;return a=function(){return e},e}r(702)},794:function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.unfollow=t.follow=t.findFollows=void 0;var n=a(r(48));function a(e){return e&&e.__esModule?e:{default:e}}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e)))return;var r=[],n=!0,a=!1,l=void 0;try{for(var o,i=e[Symbol.iterator]();!(n=(o=i.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,l=e}finally{try{n||null==i.return||i.return()}finally{if(a)throw l}}return r}(e,t)||function(){throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}()}function o(e,t,r,n,a,l,o){try{var i=e[l](o),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,a)}var i=(0,a(r(117)).default)({reducerName:\"follow\",actionType:\"SET_FOLLOW_LIST_BY_ID\",api:\"findFollows\",fields:\"\"});t.findFollows=i;var u=function(e){return function(t){var r=t.args;return function(t,a){return new Promise(function(){var i,u=(i=regeneratorRuntime.mark((function o(i){var u,c,d,s,f;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return r.status=e,u=a().user.userInfo,o.next=4,(0,n.default)({type:\"mutation\",apis:[{api:\"addFollow\",args:r,fields:\"success\"}],headers:{accessToken:a().user.accessToken}});case 4:if(c=o.sent,d=l(c,2),s=d[0],f=d[1],!s){o.next=10;break}return o.abrupt(\"return\",i([s?s.message:\"未知错误\"]));case 10:r.posts_id?(t({type:\"UPDATE_FOLLOW\",id:r.posts_id,followStatus:e,selfId:u._id}),t({type:\"UPDATE_POSTS_FOLLOW\",id:r.posts_id,followStatus:e})):r.user_id?(t({type:\"UPDATE_FOLLOW\",id:r.user_id,followStatus:e,selfId:u._id}),t({type:\"UPDATE_POSTS_AUHTOR_FOLLOW\",peopleId:r.user_id,followStatus:e,selfId:u._id}),t({type:\"UPLOAD_PEOPLE_FOLLOW\",peopleId:r.user_id,followStatus:e,selfId:u._id})):r.topic_id&&(t({type:\"UPDATE_FOLLOW\",id:r.topic_id,followStatus:e,selfId:u._id}),t({type:\"UPDATE_TOPIC_FOLLOW\",id:r.topic_id,followStatus:e})),i([null,f]);case 12:case\"end\":return o.stop()}}),o)})),function(){var e=this,t=arguments;return new Promise((function(r,n){var a=i.apply(e,t);function l(e){o(a,r,n,l,u,\"next\",e)}function u(e){o(a,r,n,l,u,\"throw\",e)}l(void 0)}))});return function(e){return u.apply(this,arguments)}}())}}},c=u(!0);t.follow=c;var d=u(!1);t.unfollow=d},849:function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0}),t.default=function(e){var t=e.topic,r=(0,l.useSelector)((function(e){return(0,o.getUserInfo)(e)}));return n.default.createElement(\"div\",null,n.default.createElement(\"img\",{src:t.avatar,className:\"rounded _1Rzja\",alt:t.name}),n.default.createElement(\"div\",null,n.default.createElement(\"div\",null,n.default.createElement(\"h6\",null,t.parent_id?n.default.createElement(n.default.Fragment,null,n.default.createElement(a.Link,{to:\"/topic/\".concat(t.parent_id._id),className:\"text-dark\"},n.default.createElement(\"b\",null,t.parent_id.name)),n.default.createElement(\"span\",{className:\"ml-2 mr-2\"},\"›\")):null,t?n.default.createElement(\"b\",null,t.name):null),n.default.createElement(\"div\",{className:\"_3pjc2\"},t.brief),n.default.createElement(\"div\",{className:\"QPyqz\"},t.posts_count?n.default.createElement(\"span\",null,t.posts_count,\" 帖子\"):null,t.follow_count?n.default.createElement(\"span\",null,t.follow_count,\" 人关注\"):null,t.comment_count?n.default.createElement(\"span\",null,t.comment_count,\" 条评论\"):null)),n.default.createElement(\"div\",{className:\"_33qIB\"},t.parent_id&&r?n.default.createElement(n.default.Fragment,null,n.default.createElement(a.Link,{to:\"/new-posts?topic_id=\".concat(t._id),className:\"btn btn-outline-primary btn-sm rounded-pill\"},\"创建话题\"),n.default.createElement(i.default,{topic:t})):null)))};var n=u(r(0)),a=r(115),l=r(168),o=r(78),i=u(r(789));function u(e){return e&&e.__esModule?e:{default:e}}r(733)}}]);","extractedComments":[]}